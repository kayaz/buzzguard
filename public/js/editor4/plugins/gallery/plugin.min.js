tinymce.PluginManager.add("gallery", function(e) {
    function openmanager() {
        var win;
        win = e.windowManager.open({
            title: 'Wstaw galerię',
            //file: tinyMCE.baseURL + '/plugins/gallery/dialog.php?editor=' + e.id + '&lang=' + tinymce.settings.language + '&subfolder=' + tinymce.settings.subfolder,
            size: 'large',
            body: {
                type: 'panel', // The root body type - a Panel or TabPanel
                items: [ // A list of panel components
                    {
                        type: 'htmlpanel', // A HTML panel component
                        html: '<div class="gallery-div">Your Gallery Items Html</div>'
                    }
                ]
            },
        })

        var el = win;
        console.table(win);

        $.ajax({
            type: "GET",
            url: "/admin/ajaxGetGalleries",
            success: function (result) {
                $.each(JSON.parse(result), function(i, item) {
                    $('<div class="col-3">' +
                        '<div class="card">' +
                        '<div class="card-body">' +
                        '<h5 class="card-title">'+item.name+'</h5>' +
                        '<div class="dropdown">' +
                        '<button class="btn btn-secondary btn-sm dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> Wstaw jako </button>' +
                        '<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">' +
                        '<a class="dropdown-item" href="#">Galeria</a>' +
                        '<a class="dropdown-item" href="#">Karuzela</a>' +
                        '<a class="dropdown-item" href="#">Slider</a>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>').appendTo(someval);

                    $( ".dropdown-item" ).on( "click", function() {
                        tinymce.activeEditor.execCommand('mceInsertContent', false, '<p>[galeria=karuzela]'+ item.id +'[/galeria]</p>');
                    });
                });
            },
            error: function () {
                alert("Wystąpił błąd połączenia z bazą")
            }
        })
    }
   e.addButton("gallery", {
        icon: "image",
        tooltip: "Wstaw galerię",
        onclick: openmanager
    })
});
